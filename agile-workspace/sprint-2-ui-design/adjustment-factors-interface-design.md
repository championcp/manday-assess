# Sprint 2 - 调整因子设置界面设计

## 一、设计概述

### 1. 设计目标
- **精准调整：** 严格按照NESMA标准实现技术复杂度调整因子(TCF)和复用度调整
- **专业指导：** 为每个调整因子提供专业的评分指导和参考标准
- **实时预览：** 实时显示调整对最终功能点的影响
- **合规性强：** 确保所有调整计算与政府评审指南100%一致

### 2. 调整因子体系
```
NESMA调整因子系统
├── 技术复杂度调整因子 (TCF)
│   ├── 14个标准技术因子评估
│   └── VAF = (0.65 + (总影响度 × 0.01))
└── 复用度调整因子 (RAF)
    ├── 高复用度：系数 = 0.3333
    ├── 中复用度：系数 = 0.6667
    ├── 低复用度：系数 = 1.0000
    └── 无复用：系数 = 1.0000
```

## 二、整体界面布局设计

### 1. 主界面框架

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                           NESMA调整因子设置                                │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│ ┌─ 调整概览区 ─────────────────────────────────────────────────────────────┐ │
│ │ 当前UFP: 122 FP  →  VAF调整: ×1.14  →  AFP: 139.08 FP                  │ │
│ │ 复用调整: ×0.6667  →  最终功能点: 92.72 FP                              │ │
│ │                                                                         │ │
│ │ 📊 调整影响可视化：                                                      │ │
│ │ UFP ████████████████████████████████████ 122 FP                        │ │
│ │ AFP ███████████████████████████████████████ 139 FP (+14%)              │ │
│ │ 最终 ██████████████████████████ 93 FP (-24%)                            │ │
│ └─────────────────────────────────────────────────────────────────────────┘ │
│                                                                             │
│ ┌─ 标签页导航 ─────────────────────────────────────────────────────────────┐ │
│ │ [技术复杂度调整] [复用度调整] [参数模板管理] [调整历史记录]               │ │
│ └─────────────────────────────────────────────────────────────────────────┘ │
│                                                                             │
│ ┌─ 当前标签页内容区 ───────────────────────────────────────────────────────┐ │
│ │                          [ 动态内容区域 ]                               │ │
│ │                        根据当前标签显示不同内容                          │ │
│ │                                                                         │ │
│ │                          [ 420px 高度固定 ]                              │ │
│ └─────────────────────────────────────────────────────────────────────────┘ │
│                                                                             │
│ ┌─ 操作区 ─────────────────────────────────────────────────────────────────┐ │
│ │                                                                         │ │
│ │ [重置默认] [导入模板] [保存模板]    [预览计算] [确认应用] [取消]          │ │
│ │                                                                         │ │
│ └─────────────────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 2. 调整概览区设计

```css
/* 调整概览区样式 */
.adjustment-overview {
  background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
  border: 1px solid #0891b2;
  border-radius: 12px;
  padding: 24px;
  margin-bottom: 24px;
}

.calculation-flow {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 20px;
  font-size: 16px;
  font-weight: 600;
  color: #0c4a6e;
}

.flow-step {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 8px 16px;
  background: rgba(255, 255, 255, 0.8);
  border-radius: 6px;
  border: 1px solid #bae6fd;
}

.flow-arrow {
  color: #0891b2;
  font-size: 18px;
  font-weight: bold;
}

.impact-visualization {
  margin-top: 16px;
}

.impact-bar {
  display: flex;
  align-items: center;
  gap: 12px;
  margin-bottom: 8px;
}

.bar-container {
  flex: 1;
  height: 24px;
  background: #e0f2fe;
  border-radius: 12px;
  overflow: hidden;
  position: relative;
}

.bar-fill {
  height: 100%;
  border-radius: 12px;
  transition: all 0.3s ease;
  position: relative;
}

.bar-fill.ufp { background: #0891b2; }
.bar-fill.afp { background: #06b6d4; }
.bar-fill.final { background: #0284c7; }

.bar-label {
  font-weight: 600;
  min-width: 40px;
  color: #0c4a6e;
}

.bar-value {
  font-weight: 600;
  min-width: 120px;
  text-align: right;
  color: #0c4a6e;
}
```

## 三、技术复杂度调整标签页

### 1. 14个技术复杂度因子界面

```
┌─ 技术复杂度调整因子 (TCF) 评估 ─────────────────────────────────────────────┐
│                                                                             │
│ ┌─ 评估说明 ───────────────────────────────────────────────────────────────┐ │
│ │ 📋 技术复杂度调整因子说明：                                              │ │
│ │ • 共14个标准技术因子，每个因子评分范围0-5分                              │ │
│ │ • VAF = 0.65 + (总影响度 × 0.01)                                        │ │
│ │ • 影响度范围：0-70，VAF范围：0.65-1.35                                   │ │
│ └─────────────────────────────────────────────────────────────────────────┘ │
│                                                                             │
│ ┌─ 因子评估表格 ───────────────────────────────────────────────────────────┐ │
│ │ 总影响度: 32   VAF: 1.32   当前AFP: 161.04 FP                          │ │
│ │                                                                         │ │
│ │ │#│        技术因子        │评分│影响│        评分指导        │   操作 │ │ │
│ │ ├─┼──────────────────────┼──┼──┼─────────────────────────┼──────┤ │ │
│ │ │1│数据通信                │ 4 │ 4 │[高] 分布式系统，实时通信    │[详情]│ │ │
│ │ │2│分布式数据处理          │ 3 │ 3 │[中] 部分数据分布式处理      │[详情]│ │ │
│ │ │3│性能要求                │ 4 │ 4 │[高] 严格的响应时间要求      │[详情]│ │ │
│ │ │4│配置负荷                │ 2 │ 2 │[低] 标准服务器配置          │[详情]│ │ │
│ │ │5│交易频率                │ 3 │ 3 │[中] 中等并发用户数          │[详情]│ │ │
│ │ │6│在线数据录入            │ 5 │ 5 │[极高] 大量在线数据录入      │[详情]│ │ │
│ │ │7│最终用户效率            │ 4 │ 4 │[高] 注重用户体验            │[详情]│ │ │
│ │ │8│在线更新                │ 3 │ 3 │[中] 支持实时数据更新        │[详情]│ │ │
│ │ │9│复杂内部处理            │ 2 │ 2 │[低] 逻辑相对简单            │[详情]│ │ │
│ │10│代码复用性              │ 3 │ 3 │[中] 模块化设计              │[详情]│ │ │
│ │11│安装简易性              │ 1 │ 1 │[很低] 专业安装部署          │[详情]│ │ │
│ │12│操作简易性              │ 4 │ 4 │[高] 用户友好界面            │[详情]│ │ │
│ │13│多站点使用              │ 2 │ 2 │[低] 单一部署环境            │[详情]│ │ │
│ │14│变更便利性              │ 3 │ 3 │[中] 支持配置化修改          │[详情]│ │ │
│ │──┼──────────────────────┼──┼──┼─────────────────────────┼──────┤ │ │
│ │  │        合计           │  │44│                         │      │ │ │
│ └─────────────────────────────────────────────────────────────────────────┘ │
│                                                                             │
│ ┌─ 快速预设模板 ───────────────────────────────────────────────────────────┐ │
│ │ [政府标准系统] [简单管理系统] [复杂业务系统] [高性能系统] [移动应用系统] │ │
│ └─────────────────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 2. 技术因子详情弹框设计

```
┌─ 技术因子详情：数据通信 ───────────────────────────────────────────────────┐
│                                                                             │
│ ┌─ 因子说明 ───────────────────────────────────────────────────────────────┐ │
│ │ 📡 数据通信 (Data Communications)                                       │ │
│ │                                                                         │ │
│ │ 定义：系统中数据通信功能的复杂程度，包括远程数据传输、网络通信等          │ │
│ │ 影响：评估系统对网络通信的依赖程度和通信复杂度                           │ │
│ └─────────────────────────────────────────────────────────────────────────┘ │
│                                                                             │
│ ┌─ 评分标准 ───────────────────────────────────────────────────────────────┐ │
│ │ 分值    影响度    描述                                                  │ │
│ │ ────   ──────   ────────────────────────────────────────────────────  │ │
│ │  0      无影响   应用是纯批处理系统或单机系统，无数据通信需求             │ │
│ │  1      偶然     应用是批处理系统但有远程数据录入或远程打印              │ │
│ │  2      轻度     应用是批处理系统但有远程数据录入和远程打印              │ │
│ │  3      一般     应用包含在线数据收集或TP前端但仅支持单类型通信协议       │ │
│ │  4      重要     应用包含在线数据收集或TP前端但支持多种通信协议           │ │
│ │  5      关键     应用包含在线数据收集或TP前端且支持多种通信协议和网络     │ │
│ └─────────────────────────────────────────────────────────────────────────┘ │
│                                                                             │
│ ┌─ 评分选择 ───────────────────────────────────────────────────────────────┐ │
│ │                                                                         │ │
│ │ 当前评分: ●━━━━━━━━━━● 4分 (重要)                                        │ │
│ │          0  1  2  3  4  5                                               │ │
│ │                                                                         │ │
│ │ 评分理由: [___________________________________________________]        │ │
│ │          本系统为分布式架构，支持多种网络通信协议                         │ │
│ │                                                                         │ │
│ └─────────────────────────────────────────────────────────────────────────┘ │
│                                                                             │
│ ┌─ 参考案例 ───────────────────────────────────────────────────────────────┐ │
│ │ 🏛️ 政府系统案例：                                                        │ │
│ │ • 财政管理系统 (4分): 与多个外部系统实时数据交换                         │ │
│ │ • 政务服务平台 (5分): 支持多种接入方式和通信协议                         │ │
│ │ • 内部OA系统 (2分): 主要局域网内部使用                                   │ │
│ └─────────────────────────────────────────────────────────────────────────┘ │
│                                                                             │
│                                     [取消]  [确定]                         │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 3. TCF计算逻辑设计

```javascript
// 技术复杂度调整因子计算
const TCFCalculator = {
  // 14个标准技术因子定义
  factors: [
    { id: 1, name: '数据通信', nameEn: 'Data Communications', weight: 1 },
    { id: 2, name: '分布式数据处理', nameEn: 'Distributed Data Processing', weight: 1 },
    { id: 3, name: '性能要求', nameEn: 'Performance', weight: 1 },
    { id: 4, name: '配置负荷', nameEn: 'Heavily Used Configuration', weight: 1 },
    { id: 5, name: '交易频率', nameEn: 'Transaction Rate', weight: 1 },
    { id: 6, name: '在线数据录入', nameEn: 'On-Line Data Entry', weight: 1 },
    { id: 7, name: '最终用户效率', nameEn: 'End-User Efficiency', weight: 1 },
    { id: 8, name: '在线更新', nameEn: 'On-Line Update', weight: 1 },
    { id: 9, name: '复杂内部处理', nameEn: 'Complex Processing', weight: 1 },
    { id: 10, name: '代码复用性', nameEn: 'Reusability', weight: 1 },
    { id: 11, name: '安装简易性', nameEn: 'Installation Ease', weight: 1 },
    { id: 12, name: '操作简易性', nameEn: 'Operational Ease', weight: 1 },
    { id: 13, name: '多站点使用', nameEn: 'Multiple Sites', weight: 1 },
    { id: 14, name: '变更便利性', nameEn: 'Facilitate Change', weight: 1 }
  ],
  
  // 评分标准定义
  scoreDefinitions: {
    1: { // 数据通信
      0: '应用是纯批处理系统或单机系统，无数据通信需求',
      1: '应用是批处理系统但有远程数据录入或远程打印',
      2: '应用是批处理系统但有远程数据录入和远程打印',
      3: '应用包含在线数据收集或TP前端但仅支持单类型通信协议',
      4: '应用包含在线数据收集或TP前端但支持多种通信协议',
      5: '应用包含在线数据收集或TP前端且支持多种通信协议和网络'
    },
    // ... 其他13个因子的评分标准
  },
  
  // 预设模板
  templates: {
    '政府标准系统': [3, 2, 4, 2, 3, 4, 4, 3, 2, 3, 2, 4, 2, 3], // 总分41
    '简单管理系统': [2, 1, 2, 2, 2, 3, 3, 2, 1, 2, 3, 3, 1, 2], // 总分29
    '复杂业务系统': [4, 4, 4, 3, 4, 5, 4, 4, 4, 3, 2, 4, 3, 4], // 总分52
    '高性能系统': [5, 4, 5, 4, 5, 4, 3, 4, 3, 3, 2, 3, 3, 3], // 总分51
    '移动应用系统': [4, 3, 4, 3, 4, 5, 5, 4, 2, 3, 4, 5, 4, 4] // 总分54
  },
  
  // 计算VAF
  calculateVAF(scores) {
    // 验证输入
    if (!Array.isArray(scores) || scores.length !== 14) {
      throw new Error('技术因子评分必须是14个0-5之间的整数')
    }
    
    // 验证每个分数
    for (let i = 0; i < scores.length; i++) {
      if (!Number.isInteger(scores[i]) || scores[i] < 0 || scores[i] > 5) {
        throw new Error(`第${i + 1}个因子评分必须是0-5之间的整数`)
      }
    }
    
    // 计算总影响度
    const totalInfluence = scores.reduce((sum, score, index) => {
      return sum + (score * this.factors[index].weight)
    }, 0)
    
    // 计算VAF = 0.65 + (总影响度 × 0.01)
    const vaf = 0.65 + (totalInfluence * 0.01)
    
    // 确保VAF在有效范围内
    const finalVAF = Math.max(0.65, Math.min(1.35, vaf))
    
    return {
      scores: scores,
      totalInfluence: totalInfluence,
      vaf: parseFloat(finalVAF.toFixed(4)),
      details: scores.map((score, index) => ({
        id: this.factors[index].id,
        name: this.factors[index].name,
        nameEn: this.factors[index].nameEn,
        score: score,
        influence: score * this.factors[index].weight
      }))
    }
  },
  
  // 应用预设模板
  applyTemplate(templateName) {
    const template = this.templates[templateName]
    if (!template) {
      throw new Error(`模板 "${templateName}" 不存在`)
    }
    
    return this.calculateVAF(template)
  },
  
  // 验证评分合理性
  validateScores(scores) {
    const result = this.calculateVAF(scores)
    const warnings = []
    
    // 检查极端值
    const highScores = scores.filter(s => s >= 4).length
    const lowScores = scores.filter(s => s <= 1).length
    
    if (highScores > 10) {
      warnings.push('高分(4-5分)因子过多，请确认评估的准确性')
    }
    
    if (lowScores > 10) {
      warnings.push('低分(0-1分)因子过多，可能低估了系统复杂度')
    }
    
    // 检查VAF范围
    if (result.vaf < 0.8) {
      warnings.push('VAF值较低，请确认系统确实简单')
    }
    
    if (result.vaf > 1.2) {
      warnings.push('VAF值较高，请确认系统确实复杂')
    }
    
    return {
      ...result,
      warnings: warnings,
      valid: warnings.length === 0
    }
  }
}
```

## 四、复用度调整标签页

### 1. 复用度调整界面

```
┌─ 复用度调整因子 (RAF) 设置 ─────────────────────────────────────────────────┐
│                                                                             │
│ ┌─ 调整说明 ───────────────────────────────────────────────────────────────┐ │
│ │ 🔄 复用度调整因子说明：                                                  │ │
│ │ • 基于软件复用程度对功能点进行调整                                       │ │
│ │ • 最终功能点 = AFP × 复用度系数                                         │ │
│ │ • 复用度越高，实际开发工作量越少，最终功能点越低                         │ │
│ └─────────────────────────────────────────────────────────────────────────┘ │
│                                                                             │
│ ┌─ 复用等级选择 ───────────────────────────────────────────────────────────┐ │
│ │                                                                         │ │
│ │ ○ 高复用度 (High Reuse)    系数: 0.3333                                 │ │
│ │   适用场景: 大量使用现有组件、框架或模板开发                             │ │
│ │   典型特征: >70%代码可复用，主要进行配置和集成工作                       │ │
│ │   政府案例: 基于统一平台的二期系统开发                                   │ │
│ │                                                                         │ │
│ │ ● 中复用度 (Medium Reuse)  系数: 0.6667                                 │ │
│ │   适用场景: 部分使用现有组件，需要一定程度的定制开发                     │ │
│ │   典型特征: 30-70%代码可复用，需要适度的定制开发                         │ │
│ │   政府案例: 在现有系统基础上的功能扩展                                   │ │
│ │                                                                         │ │
│ │ ○ 低复用度 (Low Reuse)     系数: 1.0000                                 │ │
│ │   适用场景: 少量使用现有组件，主要为新开发                               │ │
│ │   典型特征: 10-30%代码可复用，大部分需要重新开发                         │ │
│ │   政府案例: 新建系统但使用标准框架和组件                                 │ │
│ │                                                                         │ │
│ │ ○ 无复用 (No Reuse)        系数: 1.0000                                 │ │
│ │   适用场景: 完全新开发，不使用任何现有组件                               │ │
│ │   典型特征: <10%代码可复用，全新架构和技术栈                             │ │
│ │   政府案例: 创新性业务系统或特殊需求系统                                 │ │
│ │                                                                         │ │
│ └─────────────────────────────────────────────────────────────────────────┘ │
│                                                                             │
│ ┌─ 复用度评估指导 ─────────────────────────────────────────────────────────┐ │
│ │                                                                         │ │
│ │ 📋 复用度评估指标：                                                      │ │
│ │                                                                         │ │
│ │ ✅ 架构复用    ☐ 使用现有技术架构   ☐ 沿用现有部署方案                  │ │
│ │ ✅ 组件复用    ☐ 使用通用业务组件   ☐ 复用数据访问层                    │ │
│ │ ✅ 界面复用    ☐ 使用标准UI组件     ☐ 沿用现有界面风格                  │ │
│ │ ☐ 数据复用    ☐ 共享现有数据结构   ☐ 复用数据字典                      │ │
│ │ ☐ 流程复用    ☐ 使用标准业务流程   ☐ 复用工作流引擎                    │ │
│ │ ☐ 测试复用    ☐ 复用测试用例       ☐ 使用自动化测试框架                │ │
│ │                                                                         │ │
│ │ 复用度建议: 中复用度 (基于3个维度的复用)                                 │ │
│ │                                                                         │ │
│ └─────────────────────────────────────────────────────────────────────────┘ │
│                                                                             │
│ ┌─ 调整影响分析 ───────────────────────────────────────────────────────────┐ │
│ │                                                                         │ │
│ │ 当前计算结果：                                                           │ │
│ │ UFP: 122 FP  →  VAF调整(×1.32)  →  AFP: 161.04 FP                     │ │
│ │ 中复用度调整(×0.6667)  →  最终功能点: 107.36 FP                         │ │
│ │                                                                         │ │
│ │ 不同复用度对比：                                                         │ │
│ │ • 高复用度: 161.04 × 0.3333 = 53.67 FP  (节省 66.7%)                  │ │
│ │ • 中复用度: 161.04 × 0.6667 = 107.36 FP (节省 33.3%)                  │ │
│ │ • 低复用度: 161.04 × 1.0000 = 161.04 FP (无节省)                       │ │
│ │ • 无复用:   161.04 × 1.0000 = 161.04 FP (无节省)                       │ │
│ │                                                                         │ │
│ └─────────────────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────────────────┘
```

这个调整因子设置界面设计提供了完整的技术复杂度调整和复用度调整功能，严格遵循NESMA标准，确保政府项目评估的准确性和专业性。