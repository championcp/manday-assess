# ğŸ­ é•¿æ²™å¸‚è´¢æ”¿è¯„å®¡ä¸­å¿ƒè½¯ä»¶è§„æ¨¡è¯„ä¼°ç³»ç»Ÿ
## ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²é…ç½®æ–¹æ¡ˆ

### ğŸ¯ éƒ¨ç½²ç›®æ ‡

**æ€»ä½“ç›®æ ‡**: ä¸ºé•¿æ²™å¸‚è´¢æ”¿è¯„å®¡ä¸­å¿ƒè½¯ä»¶è§„æ¨¡è¯„ä¼°ç³»ç»Ÿæ„å»ºç¨³å®šã€å®‰å…¨ã€é«˜æ€§èƒ½çš„ç”Ÿäº§ç¯å¢ƒï¼Œç¡®ä¿ç³»ç»Ÿ7Ã—24å°æ—¶ç¨³å®šè¿è¡Œï¼Œæ»¡è¶³æ”¿åºœçº§ä¿¡æ¯åŒ–é¡¹ç›®çš„éƒ¨ç½²è¦æ±‚ã€‚

**æ ¸å¿ƒè¦æ±‚**:
- **é«˜å¯ç”¨æ€§**: ç³»ç»Ÿå¯ç”¨æ€§â‰¥99.5%ï¼Œå¹´æ•…éšœæ—¶é—´<43.8å°æ—¶
- **é«˜æ€§èƒ½**: ç³»ç»Ÿå“åº”æ—¶é—´<2ç§’ï¼Œæ”¯æŒ50+å¹¶å‘ç”¨æˆ·
- **é«˜å®‰å…¨æ€§**: æ»¡è¶³æ”¿åºœä¿¡æ¯å®‰å…¨ç­‰çº§ä¿æŠ¤ä¸‰çº§è¦æ±‚
- **å¯æ‰©å±•æ€§**: æ”¯æŒç”¨æˆ·æ•°é‡å’Œæ•°æ®é‡å¢é•¿50%ä»¥ä¸Š
- **å¯ç»´æŠ¤æ€§**: æ”¯æŒçƒ­éƒ¨ç½²å‡çº§ï¼Œè¿ç»´æ“ä½œè‡ªåŠ¨åŒ–

### ğŸ—ï¸ ç³»ç»Ÿæ¶æ„è®¾è®¡

#### æ•´ä½“æ¶æ„å›¾
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Internet                             â”‚
â”‚                        â”‚                               â”‚
â”‚                  â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”                         â”‚
â”‚                  â”‚   Nginx    â”‚                         â”‚
â”‚                  â”‚Load Balanceâ”‚                         â”‚
â”‚                  â”‚  & Proxy   â”‚                         â”‚
â”‚                  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                         â”‚
â”‚                        â”‚                               â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚              â”‚         â”‚         â”‚                     â”‚
â”‚         â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â” â”Œâ”€â”€â–¼â”€â”€â” â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”                â”‚
â”‚         â”‚Frontend â”‚ â”‚     â”‚ â”‚Frontend â”‚                â”‚
â”‚         â”‚ Vue App â”‚ â”‚     â”‚ â”‚ Vue App â”‚                â”‚
â”‚         â”‚ (ä¸»æœåŠ¡å™¨)â”‚ â”‚     â”‚ â”‚(å¤‡æœåŠ¡å™¨)â”‚                â”‚
â”‚         â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â”‚     â”‚ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                â”‚
â”‚              â”‚      â”‚     â”‚      â”‚                     â”‚
â”‚              â”‚      â”‚     â”‚      â”‚                     â”‚
â”‚         â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”                â”‚
â”‚         â”‚        Backend API           â”‚                â”‚
â”‚         â”‚     Spring Boot Cluster     â”‚                â”‚
â”‚         â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚                â”‚
â”‚         â”‚   â”‚ Backend â”‚ â”‚ Backend â”‚   â”‚                â”‚
â”‚         â”‚   â”‚Node 1   â”‚ â”‚ Node 2  â”‚   â”‚                â”‚
â”‚         â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚                â”‚
â”‚         â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                â”‚
â”‚              â”‚                  â”‚                     â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”               â”‚
â”‚    â”‚ PostgreSQL   â”‚    â”‚     Redis    â”‚               â”‚
â”‚    â”‚   Master     â”‚    â”‚    Cache     â”‚               â”‚
â”‚    â”‚              â”‚    â”‚   Cluster    â”‚               â”‚
â”‚    â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚          â”‚                                            â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”                                   â”‚
â”‚    â”‚ PostgreSQL   â”‚                                   â”‚
â”‚    â”‚   Replica    â”‚                                   â”‚
â”‚    â”‚   (åªè¯»)     â”‚                                   â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### æœåŠ¡å™¨é…ç½®è§„æ ¼

**WebæœåŠ¡å™¨ (Nginx)** - 2å°
```yaml
æœåŠ¡å™¨è§„æ ¼:
  CPU: 4æ ¸å¿ƒ Intel Xeonå¤„ç†å™¨
  å†…å­˜: 8GB DDR4 ECC
  å­˜å‚¨: 200GB SSD
  ç½‘ç»œ: åŒåƒå…†ç½‘å¡ï¼ŒåŒä¸Šè”é“¾è·¯
  æ“ä½œç³»ç»Ÿ: CentOS 8 / Ubuntu 20.04 LTS

è½¯ä»¶é…ç½®:
  Nginx: 1.22+
  SSLè¯ä¹¦: æ”¿åºœCAé¢å‘çš„SSLè¯ä¹¦
  é˜²ç«å¢™: iptables + fail2ban
  ç›‘æ§: Nginxç›‘æ§æ¨¡å—
```

**åº”ç”¨æœåŠ¡å™¨ (Spring Boot)** - 2å°
```yaml
æœåŠ¡å™¨è§„æ ¼:
  CPU: 8æ ¸å¿ƒ Intel Xeonå¤„ç†å™¨
  å†…å­˜: 16GB DDR4 ECC
  å­˜å‚¨: 500GB SSD
  ç½‘ç»œ: åŒåƒå…†ç½‘å¡
  æ“ä½œç³»ç»Ÿ: CentOS 8 / Ubuntu 20.04 LTS

è½¯ä»¶ç¯å¢ƒ:
  Java: OpenJDK 17
  Spring Boot: 2.7.18
  Docker: 24.0+
  Docker Compose: 2.20+
  ç›‘æ§: Micrometer + Prometheus
```

**æ•°æ®åº“æœåŠ¡å™¨ (PostgreSQL)** - ä¸»ä»2å°
```yaml
ä¸»æ•°æ®åº“æœåŠ¡å™¨:
  CPU: 12æ ¸å¿ƒ Intel Xeonå¤„ç†å™¨
  å†…å­˜: 32GB DDR4 ECC
  å­˜å‚¨: 1TB NVMe SSD (æ•°æ®) + 500GB SSD (æ—¥å¿—)
  ç½‘ç»œ: ä¸‡å…†ç½‘å¡
  æ“ä½œç³»ç»Ÿ: CentOS 8ä¸“ç”¨æ•°æ®åº“ç‰ˆæœ¬

ä»æ•°æ®åº“æœåŠ¡å™¨:
  CPU: 8æ ¸å¿ƒ Intel Xeonå¤„ç†å™¨
  å†…å­˜: 16GB DDR4 ECC
  å­˜å‚¨: 1TB NVMe SSD
  ç½‘ç»œ: åƒå…†ç½‘å¡
  æ“ä½œç³»ç»Ÿ: CentOS 8ä¸“ç”¨æ•°æ®åº“ç‰ˆæœ¬

æ•°æ®åº“è½¯ä»¶:
  PostgreSQL: 15.4+
  è¿æ¥æ± : PgBouncer
  å¤‡ä»½: pg_dump + pg_basebackup
  ç›‘æ§: pg_stat_monitor
```

**ç¼“å­˜æœåŠ¡å™¨ (Redis)** - ä¸»ä»2å°
```yaml
ç¼“å­˜æœåŠ¡å™¨è§„æ ¼:
  CPU: 4æ ¸å¿ƒå¤„ç†å™¨
  å†…å­˜: 16GB DDR4 (ç¼“å­˜ä¸“ç”¨)
  å­˜å‚¨: 200GB SSD
  ç½‘ç»œ: åƒå…†ç½‘å¡
  æ“ä½œç³»ç»Ÿ: CentOS 8

Redisé…ç½®:
  Redis: 7.0+
  é›†ç¾¤æ¨¡å¼: Master-Replica
  æŒä¹…åŒ–: RDB + AOF
  ç›‘æ§: Redis Sentinel
```

### ğŸ³ Dockerå®¹å™¨åŒ–éƒ¨ç½²

#### Docker Compose ç”Ÿäº§é…ç½®

**docker-compose.prod.yml**
```yaml
version: '3.8'

services:
  # Nginxè´Ÿè½½å‡è¡¡å’Œåå‘ä»£ç†
  nginx:
    image: nginx:1.22-alpine
    container_name: manday-nginx
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./nginx/nginx.conf:/etc/nginx/nginx.conf:ro
      - ./nginx/ssl:/etc/nginx/ssl:ro
      - ./logs/nginx:/var/log/nginx
    depends_on:
      - backend-1
      - backend-2
    restart: always
    networks:
      - manday-network
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost/health"]
      interval: 30s
      timeout: 10s
      retries: 3

  # åç«¯åº”ç”¨æœåŠ¡ - èŠ‚ç‚¹1
  backend-1:
    build:
      context: ./src/backend
      dockerfile: Dockerfile.prod
    container_name: manday-backend-1
    environment:
      - SPRING_PROFILES_ACTIVE=prod
      - SPRING_DATASOURCE_URL=jdbc:postgresql://postgres-master:5432/manday_assess
      - SPRING_DATASOURCE_USERNAME=${DB_USERNAME}
      - SPRING_DATASOURCE_PASSWORD=${DB_PASSWORD}
      - SPRING_REDIS_HOST=redis-master
      - SPRING_REDIS_PORT=6379
      - SPRING_REDIS_PASSWORD=${REDIS_PASSWORD}
      - SERVER_PORT=8080
      - JVM_OPTS=-Xms2g -Xmx4g -XX:+UseG1GC
    ports:
      - "8081:8080"
    volumes:
      - ./logs/backend-1:/app/logs
      - ./uploads:/app/uploads
    depends_on:
      - postgres-master
      - redis-master
    restart: always
    networks:
      - manday-network
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8080/actuator/health"]
      interval: 30s
      timeout: 10s
      retries: 3

  # åç«¯åº”ç”¨æœåŠ¡ - èŠ‚ç‚¹2
  backend-2:
    build:
      context: ./src/backend
      dockerfile: Dockerfile.prod
    container_name: manday-backend-2
    environment:
      - SPRING_PROFILES_ACTIVE=prod
      - SPRING_DATASOURCE_URL=jdbc:postgresql://postgres-master:5432/manday_assess
      - SPRING_DATASOURCE_USERNAME=${DB_USERNAME}
      - SPRING_DATASOURCE_PASSWORD=${DB_PASSWORD}
      - SPRING_REDIS_HOST=redis-master
      - SPRING_REDIS_PORT=6379
      - SPRING_REDIS_PASSWORD=${REDIS_PASSWORD}
      - SERVER_PORT=8080
      - JVM_OPTS=-Xms2g -Xmx4g -XX:+UseG1GC
    ports:
      - "8082:8080"
    volumes:
      - ./logs/backend-2:/app/logs
      - ./uploads:/app/uploads
    depends_on:
      - postgres-master
      - redis-master
    restart: always
    networks:
      - manday-network
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8080/actuator/health"]
      interval: 30s
      timeout: 10s
      retries: 3

  # PostgreSQLä¸»æ•°æ®åº“
  postgres-master:
    image: postgres:15.4
    container_name: manday-postgres-master
    environment:
      - POSTGRES_DB=manday_assess
      - POSTGRES_USER=${DB_USERNAME}
      - POSTGRES_PASSWORD=${DB_PASSWORD}
      - POSTGRES_INITDB_ARGS="--encoding=UTF8 --locale=C"
    ports:
      - "5432:5432"
    volumes:
      - postgres_data:/var/lib/postgresql/data
      - ./database/init:/docker-entrypoint-initdb.d
      - ./logs/postgres:/var/log/postgresql
      - ./database/postgresql.conf:/etc/postgresql/postgresql.conf
    command: postgres -c config_file=/etc/postgresql/postgresql.conf
    restart: always
    networks:
      - manday-network
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U ${DB_USERNAME} -d manday_assess"]
      interval: 30s
      timeout: 10s
      retries: 3

  # PostgreSQLä»æ•°æ®åº“ (åªè¯»)
  postgres-replica:
    image: postgres:15.4
    container_name: manday-postgres-replica
    environment:
      - POSTGRES_USER=${DB_USERNAME}
      - POSTGRES_PASSWORD=${DB_PASSWORD}
      - PGUSER=${DB_USERNAME}
      - POSTGRES_DB=manday_assess
      - POSTGRES_MASTER_SERVICE=postgres-master
    ports:
      - "5433:5432"
    volumes:
      - postgres_replica_data:/var/lib/postgresql/data
      - ./logs/postgres-replica:/var/log/postgresql
    depends_on:
      - postgres-master
    restart: always
    networks:
      - manday-network

  # Redisä¸»ç¼“å­˜
  redis-master:
    image: redis:7.0-alpine
    container_name: manday-redis-master
    ports:
      - "6379:6379"
    command: redis-server --requirepass ${REDIS_PASSWORD} --appendonly yes
    volumes:
      - redis_data:/data
      - ./logs/redis:/var/log/redis
    restart: always
    networks:
      - manday-network
    healthcheck:
      test: ["CMD", "redis-cli", "--raw", "incr", "ping"]
      interval: 30s
      timeout: 10s
      retries: 3

  # Redisä»ç¼“å­˜
  redis-replica:
    image: redis:7.0-alpine
    container_name: manday-redis-replica
    ports:
      - "6380:6379"
    command: redis-server --requirepass ${REDIS_PASSWORD} --replicaof redis-master 6379 --appendonly yes
    volumes:
      - redis_replica_data:/data
    depends_on:
      - redis-master
    restart: always
    networks:
      - manday-network

  # å‰ç«¯é™æ€æ–‡ä»¶æœåŠ¡
  frontend:
    build:
      context: ./src/frontend
      dockerfile: Dockerfile.prod
    container_name: manday-frontend
    ports:
      - "3000:80"
    volumes:
      - ./logs/frontend:/var/log/nginx
    restart: always
    networks:
      - manday-network
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost"]
      interval: 30s
      timeout: 10s
      retries: 3

  # Prometheusç›‘æ§
  prometheus:
    image: prom/prometheus:latest
    container_name: manday-prometheus
    ports:
      - "9090:9090"
    volumes:
      - ./monitoring/prometheus.yml:/etc/prometheus/prometheus.yml
      - prometheus_data:/prometheus
    restart: always
    networks:
      - manday-network

  # Grafanaå¯è§†åŒ–
  grafana:
    image: grafana/grafana:latest
    container_name: manday-grafana
    ports:
      - "3001:3000"
    environment:
      - GF_SECURITY_ADMIN_PASSWORD=${GRAFANA_PASSWORD}
    volumes:
      - grafana_data:/var/lib/grafana
    restart: always
    networks:
      - manday-network

volumes:
  postgres_data:
    driver: local
  postgres_replica_data:
    driver: local
  redis_data:
    driver: local
  redis_replica_data:
    driver: local
  prometheus_data:
    driver: local
  grafana_data:
    driver: local

networks:
  manday-network:
    driver: bridge
```

#### Nginxè´Ÿè½½å‡è¡¡é…ç½®

**nginx.conf**
```nginx
user nginx;
worker_processes auto;
error_log /var/log/nginx/error.log warn;
pid /var/run/nginx.pid;

events {
    worker_connections 2048;
    use epoll;
    multi_accept on;
}

http {
    include /etc/nginx/mime.types;
    default_type application/octet-stream;
    
    # æ—¥å¿—æ ¼å¼
    log_format main '$remote_addr - $remote_user [$time_local] "$request" '
                   '$status $body_bytes_sent "$http_referer" '
                   '"$http_user_agent" "$http_x_forwarded_for" '
                   'rt=$request_time uct="$upstream_connect_time" '
                   'uht="$upstream_header_time" urt="$upstream_response_time"';
    
    access_log /var/log/nginx/access.log main;
    
    # åŸºç¡€è®¾ç½®
    sendfile on;
    tcp_nopush on;
    tcp_nodelay on;
    keepalive_timeout 65;
    types_hash_max_size 2048;
    client_max_body_size 50M;
    
    # Gzipå‹ç¼©
    gzip on;
    gzip_vary on;
    gzip_min_length 1024;
    gzip_proxied any;
    gzip_comp_level 6;
    gzip_types
        text/plain
        text/css
        text/xml
        text/javascript
        application/json
        application/javascript
        application/xml+rss
        application/atom+xml
        image/svg+xml;
    
    # åç«¯æœåŠ¡å™¨æ± 
    upstream backend_pool {
        least_conn;
        server backend-1:8080 max_fails=3 fail_timeout=30s;
        server backend-2:8080 max_fails=3 fail_timeout=30s;
        keepalive 32;
    }
    
    # HTTPé‡å®šå‘åˆ°HTTPS
    server {
        listen 80;
        server_name manday-assess.changsha.gov.cn;
        return 301 https://$server_name$request_uri;
    }
    
    # HTTPSä¸»æœåŠ¡
    server {
        listen 443 ssl http2;
        server_name manday-assess.changsha.gov.cn;
        
        # SSLé…ç½®
        ssl_certificate /etc/nginx/ssl/server.crt;
        ssl_certificate_key /etc/nginx/ssl/server.key;
        ssl_session_cache shared:SSL:10m;
        ssl_session_timeout 10m;
        ssl_protocols TLSv1.2 TLSv1.3;
        ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:HIGH:!aNULL:!MD5:!RC4:!DHE;
        ssl_prefer_server_ciphers on;
        
        # å®‰å…¨å¤´
        add_header Strict-Transport-Security "max-age=31536000; includeSubDomains" always;
        add_header X-Frame-Options DENY always;
        add_header X-Content-Type-Options nosniff always;
        add_header X-XSS-Protection "1; mode=block" always;
        add_header Referrer-Policy "strict-origin-when-cross-origin" always;
        
        # å‰ç«¯é™æ€èµ„æº
        location / {
            proxy_pass http://frontend;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
            
            # ç¼“å­˜è®¾ç½®
            expires 1d;
            add_header Cache-Control "public, immutable";
        }
        
        # APIæ¥å£ä»£ç†
        location /api/ {
            proxy_pass http://backend_pool;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
            
            # è¶…æ—¶è®¾ç½®
            proxy_connect_timeout 30s;
            proxy_send_timeout 60s;
            proxy_read_timeout 60s;
            
            # ç¼“å†²è®¾ç½®
            proxy_buffering on;
            proxy_buffer_size 4k;
            proxy_buffers 8 4k;
            proxy_busy_buffers_size 8k;
            
            # ä¸ç¼“å­˜åŠ¨æ€å†…å®¹
            expires -1;
            add_header Cache-Control "no-cache, no-store, must-revalidate";
        }
        
        # å¥åº·æ£€æŸ¥
        location /health {
            access_log off;
            return 200 "healthy\n";
            add_header Content-Type text/plain;
        }
        
        # ç›‘æ§ç«¯ç‚¹
        location /nginx_status {
            stub_status on;
            access_log off;
            allow 127.0.0.1;
            allow 10.0.0.0/8;
            allow 172.16.0.0/12;
            allow 192.168.0.0/16;
            deny all;
        }
    }
}
```

### ğŸ”§ ç”Ÿäº§ç¯å¢ƒé…ç½®

#### Spring Bootç”Ÿäº§é…ç½®

**application-prod.yml**
```yaml
# æœåŠ¡å™¨é…ç½®
server:
  port: 8080
  servlet:
    context-path: /
  tomcat:
    threads:
      max: 200
      min-spare: 20
    connection-timeout: 30000
    accept-count: 300
    max-connections: 8192
  compression:
    enabled: true
    mime-types: text/html,text/css,application/json,application/javascript
    min-response-size: 1024

# æ•°æ®æºé…ç½®
spring:
  application:
    name: manday-assess-backend
  profiles:
    active: prod
    
  # æ•°æ®åº“é…ç½®
  datasource:
    type: com.zaxxer.hikari.HikariDataSource
    url: jdbc:postgresql://postgres-master:5432/manday_assess?useSSL=true&serverTimezone=Asia/Shanghai
    username: ${DB_USERNAME:manday_user}
    password: ${DB_PASSWORD:}
    driver-class-name: org.postgresql.Driver
    hikari:
      pool-name: MandayHikariPool
      minimum-idle: 10
      maximum-pool-size: 50
      connection-timeout: 30000
      idle-timeout: 600000
      max-lifetime: 1800000
      connection-test-query: SELECT 1
      
  # JPAé…ç½®
  jpa:
    hibernate:
      ddl-auto: validate
      naming:
        physical-strategy: org.hibernate.boot.model.naming.PhysicalNamingStrategyStandardImpl
    show-sql: false
    database-platform: org.hibernate.dialect.PostgreSQLDialect
    properties:
      hibernate:
        format_sql: false
        use_sql_comments: false
        jdbc:
          batch_size: 20
        cache:
          use_second_level_cache: true
          region:
            factory_class: org.hibernate.cache.jcache.JCacheRegionFactory
            
  # Redisé…ç½®
  redis:
    host: redis-master
    port: 6379
    password: ${REDIS_PASSWORD:}
    database: 0
    timeout: 3000ms
    jedis:
      pool:
        max-active: 20
        max-idle: 10
        min-idle: 5
        max-wait: 3000ms
        
  # ç¼“å­˜é…ç½®
  cache:
    type: redis
    redis:
      time-to-live: 3600000
      key-prefix: "manday:"
      use-key-prefix: true
      cache-null-values: false

# æ—¥å¿—é…ç½®
logging:
  level:
    root: INFO
    gov.changsha.finance: INFO
    org.springframework.security: WARN
    org.hibernate.SQL: WARN
    org.hibernate.type.descriptor.sql.BasicBinder: WARN
  pattern:
    console: '%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{50} - %msg%n'
    file: '%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{50} - %msg%n'
  file:
    name: /app/logs/manday-assess.log
    max-size: 100MB
    max-history: 30
    total-size-cap: 10GB

# å®‰å…¨é…ç½®
security:
  jwt:
    secret: ${JWT_SECRET:MandayAssessJwtSecretKeyForProductionEnvironment2025}
    expiration: 86400  # 24å°æ—¶
    refresh-expiration: 604800  # 7å¤©
    
# ç›‘æ§é…ç½®
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus
  endpoint:
    health:
      show-details: when_authorized
      roles: ADMIN
  metrics:
    export:
      prometheus:
        enabled: true
        
# æ–‡ä»¶ä¸Šä¼ é…ç½®
file:
  upload:
    path: /app/uploads/
    max-size: 50MB
    allowed-types: .pdf,.doc,.docx,.xls,.xlsx,.png,.jpg,.jpeg

# ä¸šåŠ¡é…ç½®
manday:
  nesma:
    calculation:
      timeout: 300  # 5åˆ†é’Ÿè¶…æ—¶
      batch-size: 100  # æ‰¹é‡å¤„ç†å¤§å°
    validation:
      strict-mode: true
      auto-correct: false
  audit:
    enabled: true
    retention-days: 365
    
# æ€§èƒ½é…ç½®
spring.jpa.properties.hibernate:
  jdbc.batch_size: 20
  order_inserts: true
  order_updates: true
  batch_versioned_data: true
```

#### PostgreSQLç”Ÿäº§é…ç½®

**postgresql.conf**
```conf
# åŸºç¡€é…ç½®
listen_addresses = '*'
port = 5432
max_connections = 200
shared_preload_libraries = 'pg_stat_statements'

# å†…å­˜é…ç½®
shared_buffers = 8GB
effective_cache_size = 24GB
maintenance_work_mem = 2GB
checkpoint_completion_target = 0.9
wal_buffers = 256MB
default_statistics_target = 100

# æ£€æŸ¥ç‚¹é…ç½®
checkpoint_timeout = 15min
max_wal_size = 4GB
min_wal_size = 1GB

# æ—¥å¿—é…ç½®
logging_collector = on
log_directory = '/var/log/postgresql'
log_filename = 'postgresql-%Y-%m-%d_%H%M%S.log'
log_min_duration_statement = 1000
log_line_prefix = '%t [%p]: [%l-1] user=%u,db=%d,app=%a,client=%h '
log_checkpoints = on
log_connections = on
log_disconnections = on
log_lock_waits = on
log_temp_files = 0

# æ€§èƒ½ä¼˜åŒ–
random_page_cost = 1.1  # SSDä¼˜åŒ–
effective_io_concurrency = 200
work_mem = 64MB
huge_pages = try

# å½’æ¡£å’Œå¤åˆ¶
wal_level = replica
archive_mode = on
archive_command = 'cp %p /var/lib/postgresql/archive/%f'
max_wal_senders = 3
hot_standby = on
```

### ğŸ“Š ç›‘æ§å’Œå‘Šè­¦ç³»ç»Ÿ

#### Prometheusç›‘æ§é…ç½®

**prometheus.yml**
```yaml
global:
  scrape_interval: 15s
  evaluation_interval: 15s

rule_files:
  - "/etc/prometheus/alert.rules.yml"

alerting:
  alertmanagers:
    - static_configs:
        - targets:
          - alertmanager:9093

scrape_configs:
  # åº”ç”¨ç›‘æ§
  - job_name: 'manday-backend'
    static_configs:
      - targets: ['backend-1:8080', 'backend-2:8080']
    metrics_path: '/actuator/prometheus'
    scrape_interval: 30s

  # Nginxç›‘æ§
  - job_name: 'nginx'
    static_configs:
      - targets: ['nginx:80']
    metrics_path: '/nginx_status'
    scrape_interval: 30s

  # PostgreSQLç›‘æ§
  - job_name: 'postgres'
    static_configs:
      - targets: ['postgres-exporter:9187']
    scrape_interval: 30s

  # Redisç›‘æ§
  - job_name: 'redis'
    static_configs:
      - targets: ['redis-exporter:9121']
    scrape_interval: 30s

  # ç³»ç»Ÿç›‘æ§
  - job_name: 'node'
    static_configs:
      - targets: ['node-exporter:9100']
    scrape_interval: 30s
```

#### å…³é”®å‘Šè­¦è§„åˆ™

**alert.rules.yml**
```yaml
groups:
- name: manday-assess-alerts
  rules:
  # åº”ç”¨æœåŠ¡å‘Šè­¦
  - alert: ApplicationDown
    expr: up{job="manday-backend"} == 0
    for: 1m
    labels:
      severity: critical
    annotations:
      summary: "åº”ç”¨æœåŠ¡ä¸‹çº¿"
      description: "{{ $labels.instance }} åº”ç”¨æœåŠ¡å·²ä¸‹çº¿è¶…è¿‡1åˆ†é’Ÿ"

  # å“åº”æ—¶é—´å‘Šè­¦
  - alert: HighResponseTime
    expr: histogram_quantile(0.95, rate(http_request_duration_seconds_bucket[5m])) > 2
    for: 5m
    labels:
      severity: warning
    annotations:
      summary: "å“åº”æ—¶é—´è¿‡é«˜"
      description: "95%è¯·æ±‚å“åº”æ—¶é—´è¶…è¿‡2ç§’ï¼ŒæŒç»­5åˆ†é’Ÿ"

  # CPUä½¿ç”¨ç‡å‘Šè­¦
  - alert: HighCpuUsage
    expr: 100 - (avg by(instance) (irate(node_cpu_seconds_total{mode="idle"}[5m])) * 100) > 80
    for: 10m
    labels:
      severity: warning
    annotations:
      summary: "CPUä½¿ç”¨ç‡è¿‡é«˜"
      description: "{{ $labels.instance }} CPUä½¿ç”¨ç‡è¶…è¿‡80%ï¼ŒæŒç»­10åˆ†é’Ÿ"

  # å†…å­˜ä½¿ç”¨ç‡å‘Šè­¦
  - alert: HighMemoryUsage
    expr: (node_memory_MemTotal_bytes - node_memory_MemAvailable_bytes) / node_memory_MemTotal_bytes * 100 > 85
    for: 10m
    labels:
      severity: warning
    annotations:
      summary: "å†…å­˜ä½¿ç”¨ç‡è¿‡é«˜"
      description: "{{ $labels.instance }} å†…å­˜ä½¿ç”¨ç‡è¶…è¿‡85%ï¼ŒæŒç»­10åˆ†é’Ÿ"

  # æ•°æ®åº“è¿æ¥å‘Šè­¦
  - alert: DatabaseConnectionHigh
    expr: pg_stat_activity_count > 150
    for: 5m
    labels:
      severity: warning
    annotations:
      summary: "æ•°æ®åº“è¿æ¥æ•°è¿‡é«˜"
      description: "PostgreSQLè¿æ¥æ•°è¶…è¿‡150ï¼ŒæŒç»­5åˆ†é’Ÿ"

  # ç£ç›˜ç©ºé—´å‘Šè­¦
  - alert: DiskSpaceLow
    expr: (node_filesystem_avail_bytes{mountpoint="/"} / node_filesystem_size_bytes{mountpoint="/"}) * 100 < 15
    for: 5m
    labels:
      severity: critical
    annotations:
      summary: "ç£ç›˜ç©ºé—´ä¸è¶³"
      description: "{{ $labels.instance }} æ ¹åˆ†åŒºå¯ç”¨ç©ºé—´ä½äº15%"
```

### ğŸ”„ éƒ¨ç½²è‡ªåŠ¨åŒ–è„šæœ¬

#### éƒ¨ç½²è„šæœ¬

**deploy-prod.sh**
```bash
#!/bin/bash

# ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²è„šæœ¬
# ä½œè€…ï¼šDevOps Team
# ç‰ˆæœ¬ï¼š1.0
# åˆ›å»ºæ—¶é—´ï¼š2025-09-09

set -e

# é…ç½®å˜é‡
PROJECT_NAME="manday-assess"
DEPLOY_DIR="/opt/${PROJECT_NAME}"
BACKUP_DIR="/opt/backup/${PROJECT_NAME}"
LOG_FILE="/var/log/${PROJECT_NAME}-deploy.log"

# é¢œè‰²è¾“å‡º
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

# æ—¥å¿—å‡½æ•°
log() {
    echo -e "${GREEN}[$(date +'%Y-%m-%d %H:%M:%S')]${NC} $1" | tee -a $LOG_FILE
}

error() {
    echo -e "${RED}[$(date +'%Y-%m-%d %H:%M:%S')] ERROR:${NC} $1" | tee -a $LOG_FILE
}

warning() {
    echo -e "${YELLOW}[$(date +'%Y-%m-%d %H:%M:%S')] WARNING:${NC} $1" | tee -a $LOG_FILE
}

# æ£€æŸ¥è¿è¡Œæƒé™
check_permissions() {
    if [ "$EUID" -ne 0 ]; then
        error "è¯·ä½¿ç”¨rootæƒé™è¿è¡Œæ­¤è„šæœ¬"
        exit 1
    fi
}

# æ£€æŸ¥Dockerç¯å¢ƒ
check_docker() {
    if ! command -v docker &> /dev/null; then
        error "Dockeræœªå®‰è£…ï¼Œè¯·å…ˆå®‰è£…Docker"
        exit 1
    fi
    
    if ! command -v docker-compose &> /dev/null; then
        error "Docker Composeæœªå®‰è£…ï¼Œè¯·å…ˆå®‰è£…Docker Compose"
        exit 1
    fi
    
    log "Dockerç¯å¢ƒæ£€æŸ¥é€šè¿‡"
}

# åˆ›å»ºç›®å½•ç»“æ„
create_directories() {
    log "åˆ›å»ºéƒ¨ç½²ç›®å½•ç»“æ„..."
    
    mkdir -p $DEPLOY_DIR/{logs,uploads,database,monitoring,nginx/ssl}
    mkdir -p $BACKUP_DIR/{database,uploads,config}
    
    # è®¾ç½®æƒé™
    chown -R 1000:1000 $DEPLOY_DIR/uploads
    chown -R 999:999 $DEPLOY_DIR/database
    chmod 755 $DEPLOY_DIR
    chmod 777 $DEPLOY_DIR/logs
    
    log "ç›®å½•åˆ›å»ºå®Œæˆ"
}

# å¤‡ä»½ç°æœ‰æ•°æ®
backup_existing() {
    if [ -d "$DEPLOY_DIR" ]; then
        log "å¤‡ä»½ç°æœ‰æ•°æ®..."
        
        BACKUP_TIMESTAMP=$(date +%Y%m%d_%H%M%S)
        CURRENT_BACKUP="$BACKUP_DIR/backup_$BACKUP_TIMESTAMP"
        
        mkdir -p $CURRENT_BACKUP
        
        # å¤‡ä»½æ•°æ®åº“
        if docker ps | grep -q "manday-postgres-master"; then
            log "å¤‡ä»½PostgreSQLæ•°æ®åº“..."
            docker exec manday-postgres-master pg_dump -U $DB_USERNAME manday_assess > "$CURRENT_BACKUP/database_backup.sql"
        fi
        
        # å¤‡ä»½ä¸Šä¼ æ–‡ä»¶
        if [ -d "$DEPLOY_DIR/uploads" ]; then
            log "å¤‡ä»½ä¸Šä¼ æ–‡ä»¶..."
            cp -r $DEPLOY_DIR/uploads $CURRENT_BACKUP/
        fi
        
        # å¤‡ä»½é…ç½®æ–‡ä»¶
        if [ -f "$DEPLOY_DIR/.env" ]; then
            cp $DEPLOY_DIR/.env $CURRENT_BACKUP/
        fi
        
        log "æ•°æ®å¤‡ä»½å®Œæˆï¼š$CURRENT_BACKUP"
    fi
}

# éƒ¨ç½²åº”ç”¨
deploy_application() {
    log "å¼€å§‹éƒ¨ç½²åº”ç”¨..."
    
    cd $DEPLOY_DIR
    
    # æ‹‰å–æœ€æ–°é•œåƒ
    log "æ‹‰å–æœ€æ–°Dockeré•œåƒ..."
    docker-compose -f docker-compose.prod.yml pull
    
    # åœæ­¢ç°æœ‰æœåŠ¡
    log "åœæ­¢ç°æœ‰æœåŠ¡..."
    docker-compose -f docker-compose.prod.yml down --remove-orphans
    
    # å¯åŠ¨æ–°æœåŠ¡
    log "å¯åŠ¨æ–°æœåŠ¡..."
    docker-compose -f docker-compose.prod.yml up -d
    
    # ç­‰å¾…æœåŠ¡å¯åŠ¨
    log "ç­‰å¾…æœåŠ¡å¯åŠ¨..."
    sleep 30
    
    # æ£€æŸ¥æœåŠ¡çŠ¶æ€
    check_services
}

# æ£€æŸ¥æœåŠ¡çŠ¶æ€
check_services() {
    log "æ£€æŸ¥æœåŠ¡çŠ¶æ€..."
    
    services=("nginx" "backend-1" "backend-2" "postgres-master" "redis-master" "frontend")
    failed_services=()
    
    for service in "${services[@]}"; do
        if docker ps | grep -q "manday-$service"; then
            log "âœ“ $service è¿è¡Œæ­£å¸¸"
        else
            error "âœ— $service è¿è¡Œå¼‚å¸¸"
            failed_services+=($service)
        fi
    done
    
    if [ ${#failed_services[@]} -eq 0 ]; then
        log "æ‰€æœ‰æœåŠ¡è¿è¡Œæ­£å¸¸"
        return 0
    else
        error "ä»¥ä¸‹æœåŠ¡è¿è¡Œå¼‚å¸¸ï¼š${failed_services[*]}"
        return 1
    fi
}

# å¥åº·æ£€æŸ¥
health_check() {
    log "æ‰§è¡Œå¥åº·æ£€æŸ¥..."
    
    # æ£€æŸ¥Nginx
    if curl -f http://localhost/health &> /dev/null; then
        log "âœ“ Nginxå¥åº·æ£€æŸ¥é€šè¿‡"
    else
        error "âœ— Nginxå¥åº·æ£€æŸ¥å¤±è´¥"
        return 1
    fi
    
    # æ£€æŸ¥åç«¯API
    if curl -f http://localhost/api/actuator/health &> /dev/null; then
        log "âœ“ åç«¯APIå¥åº·æ£€æŸ¥é€šè¿‡"
    else
        error "âœ— åç«¯APIå¥åº·æ£€æŸ¥å¤±è´¥"
        return 1
    fi
    
    # æ£€æŸ¥æ•°æ®åº“è¿æ¥
    if docker exec manday-postgres-master pg_isready -U $DB_USERNAME &> /dev/null; then
        log "âœ“ æ•°æ®åº“è¿æ¥æ£€æŸ¥é€šè¿‡"
    else
        error "âœ— æ•°æ®åº“è¿æ¥æ£€æŸ¥å¤±è´¥"
        return 1
    fi
    
    log "æ‰€æœ‰å¥åº·æ£€æŸ¥é€šè¿‡"
}

# æ•°æ®åº“åˆå§‹åŒ–
init_database() {
    log "åˆå§‹åŒ–æ•°æ®åº“..."
    
    # ç­‰å¾…æ•°æ®åº“å¯åŠ¨
    while ! docker exec manday-postgres-master pg_isready -U $DB_USERNAME &> /dev/null; do
        log "ç­‰å¾…æ•°æ®åº“å¯åŠ¨..."
        sleep 5
    done
    
    # æ‰§è¡Œæ•°æ®åº“è„šæœ¬
    if [ -f "$DEPLOY_DIR/database/init/init.sql" ]; then
        log "æ‰§è¡Œæ•°æ®åº“åˆå§‹åŒ–è„šæœ¬..."
        docker exec -i manday-postgres-master psql -U $DB_USERNAME -d manday_assess < $DEPLOY_DIR/database/init/init.sql
    fi
    
    log "æ•°æ®åº“åˆå§‹åŒ–å®Œæˆ"
}

# æ€§èƒ½æµ‹è¯•
performance_test() {
    log "æ‰§è¡Œæ€§èƒ½æµ‹è¯•..."
    
    # ç®€å•çš„è´Ÿè½½æµ‹è¯•
    ab -n 1000 -c 10 http://localhost/api/actuator/health > /tmp/performance_test.log 2>&1
    
    if [ $? -eq 0 ]; then
        log "âœ“ æ€§èƒ½æµ‹è¯•é€šè¿‡"
        grep "Requests per second" /tmp/performance_test.log | tee -a $LOG_FILE
    else
        warning "æ€§èƒ½æµ‹è¯•å¤±è´¥ï¼Œè¯·æ£€æŸ¥è¯¦ç»†æ—¥å¿—"
    fi
}

# æ¸…ç†æ—§æ•°æ®
cleanup() {
    log "æ¸…ç†æ—§æ•°æ®..."
    
    # æ¸…ç†æ—§çš„Dockeré•œåƒ
    docker image prune -f
    
    # æ¸…ç†æ—§çš„æ—¥å¿—æ–‡ä»¶ï¼ˆä¿ç•™30å¤©ï¼‰
    find $DEPLOY_DIR/logs -type f -mtime +30 -name "*.log" -delete
    
    # æ¸…ç†æ—§çš„å¤‡ä»½æ–‡ä»¶ï¼ˆä¿ç•™90å¤©ï¼‰
    find $BACKUP_DIR -type d -mtime +90 -name "backup_*" -exec rm -rf {} \;
    
    log "æ¸…ç†å®Œæˆ"
}

# éƒ¨ç½²åé…ç½®
post_deploy_config() {
    log "æ‰§è¡Œéƒ¨ç½²åé…ç½®..."
    
    # è®¾ç½®é˜²ç«å¢™è§„åˆ™
    if command -v ufw &> /dev/null; then
        ufw allow 80/tcp
        ufw allow 443/tcp
        ufw allow 22/tcp
        ufw --force enable
        log "é˜²ç«å¢™é…ç½®å®Œæˆ"
    fi
    
    # è®¾ç½®ç³»ç»ŸæœåŠ¡è‡ªå¯åŠ¨
    systemctl enable docker
    log "DockeræœåŠ¡è®¾ç½®ä¸ºå¼€æœºè‡ªå¯åŠ¨"
    
    # è®¾ç½®æ—¥å¿—è½®è½¬
    cat > /etc/logrotate.d/manday-assess << 'EOF'
/opt/manday-assess/logs/*.log {
    daily
    rotate 30
    compress
    delaycompress
    missingok
    notifempty
    create 644 root root
}
EOF
    log "æ—¥å¿—è½®è½¬é…ç½®å®Œæˆ"
}

# ä¸»å‡½æ•°
main() {
    log "å¼€å§‹${PROJECT_NAME}ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²..."
    
    # æ£€æŸ¥ç¯å¢ƒæ–‡ä»¶
    if [ ! -f ".env" ]; then
        error "ç¼ºå°‘.envç¯å¢ƒé…ç½®æ–‡ä»¶"
        exit 1
    fi
    
    # åŠ è½½ç¯å¢ƒå˜é‡
    source .env
    
    # æ‰§è¡Œéƒ¨ç½²æ­¥éª¤
    check_permissions
    check_docker
    create_directories
    backup_existing
    deploy_application
    init_database
    
    if check_services && health_check; then
        log "âœ“ éƒ¨ç½²æˆåŠŸå®Œæˆ"
        performance_test
        cleanup
        post_deploy_config
        
        log "ğŸ‰ ${PROJECT_NAME}ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²å®Œæˆï¼"
        log "è®¿é—®åœ°å€ï¼šhttps://manday-assess.changsha.gov.cn"
        log "ç›‘æ§åœ°å€ï¼šhttps://manday-assess.changsha.gov.cn:3001 (Grafana)"
    else
        error "âŒ éƒ¨ç½²å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ—¥å¿—"
        exit 1
    fi
}

# æ‰§è¡Œä¸»å‡½æ•°
main "$@"
```

#### ç¯å¢ƒå˜é‡é…ç½®æ–‡ä»¶

**.env**
```env
# æ•°æ®åº“é…ç½®
DB_USERNAME=manday_user
DB_PASSWORD=MandayStrongPassword2025!
DB_NAME=manday_assess

# Redisé…ç½®
REDIS_PASSWORD=RedisStrongPassword2025!

# JWTé…ç½®
JWT_SECRET=MandayAssessJwtSecretKeyForProductionEnvironment2025ChangshaFinance

# Grafanaé…ç½®
GRAFANA_PASSWORD=GrafanaAdminPassword2025!

# SSLè¯ä¹¦è·¯å¾„
SSL_CERT_PATH=/opt/manday-assess/nginx/ssl/server.crt
SSL_KEY_PATH=/opt/manday-assess/nginx/ssl/server.key

# åŸŸåé…ç½®
DOMAIN_NAME=manday-assess.changsha.gov.cn

# é‚®ä»¶å‘Šè­¦é…ç½®
SMTP_HOST=mail.changsha.gov.cn
SMTP_PORT=587
SMTP_USER=manday-alerts@changsha.gov.cn
SMTP_PASSWORD=MailPassword2025!

# å¤‡ä»½é…ç½®
BACKUP_RETENTION_DAYS=90
DATABASE_BACKUP_SCHEDULE="0 2 * * *"  # æ¯å¤©å‡Œæ™¨2ç‚¹å¤‡ä»½

# æ€§èƒ½é…ç½®
MAX_CONNECTIONS=200
CONNECTION_POOL_SIZE=50
CACHE_TTL=3600

# å®‰å…¨é…ç½®
ENABLE_AUDIT_LOG=true
SESSION_TIMEOUT=1800  # 30åˆ†é’Ÿ
PASSWORD_POLICY=complex
```

### ğŸ“‹ éƒ¨ç½²æ£€æŸ¥æ¸…å•

#### éƒ¨ç½²å‰æ£€æŸ¥ (Pre-Deployment)
- [ ] æœåŠ¡å™¨ç¡¬ä»¶é…ç½®è¾¾æ ‡
- [ ] æ“ä½œç³»ç»Ÿç‰ˆæœ¬å…¼å®¹
- [ ] Dockerå’ŒDocker Composeå·²å®‰è£…
- [ ] ç½‘ç»œé˜²ç«å¢™é…ç½®æ­£ç¡®
- [ ] SSLè¯ä¹¦å·²å‡†å¤‡å¹¶æœ‰æ•ˆ
- [ ] åŸŸåDNSè§£ææ­£ç¡®é…ç½®
- [ ] æ•°æ®åº“å¤‡ä»½ç­–ç•¥ç¡®å®š
- [ ] ç›‘æ§å‘Šè­¦é…ç½®å®Œæˆ

#### éƒ¨ç½²è¿‡ç¨‹æ£€æŸ¥ (During Deployment)
- [ ] æ‰€æœ‰Dockerå®¹å™¨æ­£å¸¸å¯åŠ¨
- [ ] æ•°æ®åº“è¿æ¥æµ‹è¯•é€šè¿‡
- [ ] Redisç¼“å­˜è¿æ¥æ­£å¸¸
- [ ] Nginxè´Ÿè½½å‡è¡¡å·¥ä½œæ­£å¸¸
- [ ] HTTPSè¯ä¹¦é…ç½®æ­£ç¡®
- [ ] é™æ€èµ„æºè®¿é—®æ­£å¸¸
- [ ] APIæ¥å£å“åº”æ­£å¸¸

#### éƒ¨ç½²åéªŒè¯ (Post-Deployment)
- [ ] ç³»ç»Ÿç™»å½•åŠŸèƒ½æ­£å¸¸
- [ ] é¡¹ç›®CRUDæ“ä½œæ­£å¸¸
- [ ] NESMAè®¡ç®—åŠŸèƒ½æ­£å¸¸
- [ ] æŠ¥å‘Šç”ŸæˆåŠŸèƒ½æ­£å¸¸
- [ ] æ–‡ä»¶ä¸Šä¼ ä¸‹è½½æ­£å¸¸
- [ ] æ€§èƒ½æŒ‡æ ‡è¾¾æ ‡ï¼ˆå“åº”æ—¶é—´<2sï¼‰
- [ ] ç›‘æ§å›¾è¡¨æ•°æ®æ­£å¸¸
- [ ] å‘Šè­¦è§„åˆ™è§¦å‘æ­£å¸¸
- [ ] æ—¥å¿—è®°å½•å®Œæ•´
- [ ] å¤‡ä»½æ¢å¤æµç¨‹éªŒè¯

#### å®‰å…¨æ£€æŸ¥ (Security)
- [ ] SQLæ³¨å…¥æ¼æ´æ‰«æé€šè¿‡
- [ ] XSSæ”»å‡»é˜²æŠ¤æœ‰æ•ˆ
- [ ] CSRFä¿æŠ¤æœºåˆ¶å¯ç”¨
- [ ] æ–‡ä»¶ä¸Šä¼ å®‰å…¨æ£€æŸ¥
- [ ] æ•æ„Ÿä¿¡æ¯åŠ å¯†å­˜å‚¨
- [ ] APIè®¿é—®é¢‘ç‡é™åˆ¶
- [ ] ç”¨æˆ·æƒé™æ§åˆ¶æ­£ç¡®
- [ ] å®¡è®¡æ—¥å¿—è®°å½•å®Œæ•´

### ğŸ”„ å›æ»šè®¡åˆ’

#### è‡ªåŠ¨å›æ»šæ¡ä»¶
- å¥åº·æ£€æŸ¥å¤±è´¥è¶…è¿‡5åˆ†é’Ÿ
- é”™è¯¯ç‡è¶…è¿‡5%
- å“åº”æ—¶é—´è¶…è¿‡5ç§’
- æ•°æ®åº“è¿æ¥å¤±è´¥

#### æ‰‹åŠ¨å›æ»šæ­¥éª¤
```bash
# 1. åœæ­¢å½“å‰æœåŠ¡
docker-compose -f docker-compose.prod.yml down

# 2. å›æ»šåˆ°ä¸Šä¸€ä¸ªç‰ˆæœ¬
docker-compose -f docker-compose.prod.yml.backup up -d

# 3. æ¢å¤æ•°æ®åº“å¤‡ä»½ï¼ˆå¦‚éœ€è¦ï¼‰
docker exec -i manday-postgres-master psql -U $DB_USERNAME -d manday_assess < backup_latest.sql

# 4. éªŒè¯ç³»ç»ŸåŠŸèƒ½
./scripts/health-check.sh

# 5. é€šçŸ¥ç›¸å…³äººå‘˜
echo "ç³»ç»Ÿå·²å›æ»šåˆ°ä¸Šä¸€ä¸ªç¨³å®šç‰ˆæœ¬" | mail -s "ç´§æ€¥å›æ»šé€šçŸ¥" admin@changsha.gov.cn
```

---

**æ–‡æ¡£ç¼–åˆ¶**: Product Owner  
**æŠ€æœ¯å®¡æ ¸**: Developer Engineer  
**è¿ç»´å®¡æ ¸**: DevOps Engineer  
**å®‰å…¨å®¡æ ¸**: Security Specialist  
**ç‰ˆæœ¬**: V1.0  
**åˆ›å»ºæ—¶é—´**: 2025-09-09  

**é‡è¦æé†’**: ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²äº‹å…³é‡å¤§ï¼Œæ‰€æœ‰æ“ä½œå¿…é¡»ä¸¥æ ¼æŒ‰ç…§æœ¬é…ç½®æ–¹æ¡ˆæ‰§è¡Œï¼Œç¡®ä¿ç³»ç»Ÿç¨³å®šå¯é ï¼